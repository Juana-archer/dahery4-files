#!/usr/bin/env python3
# analyze_decrypted.py - Analyse le code dÃ©chiffrÃ©

import ast
import sys

def analyze_python_file(filename):
    """Analyse un fichier Python pour comprendre sa structure"""
    
    print(f"ðŸ” Analyse de {filename}")
    print("=" * 60)
    
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Parser l'AST
        tree = ast.parse(content)
        
        # Compter les Ã©lÃ©ments
        functions = [node for node in ast.walk(tree) if isinstance(node, ast.FunctionDef)]
        classes = [node for node in ast.walk(tree) if isinstance(node, ast.ClassDef)]
        imports = [node for node in ast.walk(tree) if isinstance(node, ast.Import)]
        imports_from = [node for node in ast.walk(tree) if isinstance(node, ast.ImportFrom)]
        
        print(f"ðŸ“Š Statistiques:")
        print(f"  â€¢ Lignes de code: {len(content.splitlines())}")
        print(f"  â€¢ Fonctions: {len(functions)}")
        print(f"  â€¢ Classes: {len(classes)}")
        print(f"  â€¢ Imports: {len(imports) + len(imports_from)}")
        
        # Lister les fonctions
        if functions:
            print(f"\nðŸ“‹ Fonctions trouvÃ©es:")
            for func in functions[:15]:  # Afficher les 15 premiÃ¨res
                print(f"  â€¢ {func.name}()")
            if len(functions) > 15:
                print(f"  ... et {len(functions) - 15} autres")
        
        # Lister les imports
        if imports or imports_from:
            print(f"\nðŸ“¦ Imports:")
            for imp in imports:
                for name in imp.names:
                    print(f"  â€¢ import {name.name}")
            for imp in imports_from:
                module = imp.module
                for name in imp.names:
                    print(f"  â€¢ from {module} import {name.name}")
        
        # Chercher la fonction main
        print(f"\nðŸŽ¯ Point d'entrÃ©e probable:")
        main_found = False
        for func in functions:
            if func.name.lower() == 'main':
                print(f"  â€¢ Fonction main() trouvÃ©e (ligne {func.lineno})")
                main_found = True
                break
        
        # Chercher if __name__ == '__main__'
        for node in ast.walk(tree):
            if isinstance(node, ast.If):
                try:
                    # VÃ©rifier si c'est if __name__ == '__main__'
                    if (isinstance(node.test, ast.Compare) and
                        isinstance(node.test.left, ast.Name) and
                        node.test.left.id == '__name__'):
                        print(f"  â€¢ if __name__ == '__main__' trouvÃ© (ligne {node.lineno})")
                        main_found = True
                        break
                except:
                    pass
        
        if not main_found:
            print("  â€¢ Aucun point d'entrÃ©e Ã©vident trouvÃ©")
            
        print(f"\nðŸ” PremiÃ¨res lignes:")
        print("-" * 40)
        lines = content.split('\n')
        for i in range(min(10, len(lines))):
            print(f"{i+1:3}: {lines[i][:100]}")
            
        if len(lines) > 10:
            print("...")
            
        print(f"\nðŸ” DerniÃ¨res lignes:")
        print("-" * 40)
        for i in range(max(0, len(lines)-10), len(lines)):
            print(f"{i+1:3}: {lines[i][:100]}")
        
    except Exception as e:
        print(f"âŒ Erreur d'analyse: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    if len(sys.argv) > 1:
        analyze_python_file(sys.argv[1])
    else:
        analyze_python_file("task_decrypted_fixed.py")
